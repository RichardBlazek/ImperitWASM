@inject ImperitClient http;

@using Mode = Server.Switch.Mode;

@code{
	[Parameter] public Server.Session LoggedIn { get; set; } = new Server.Session();
	[Parameter] public bool IsActive { get; set; }
	[Parameter] public Action<Mode, int?, int?> Switch { get; set; } = ((a, x, y) => { });
	[Parameter] public bool Preview { get; set; }
	[Parameter] public Func<Task>? LogoutAsync { get; set; }
	[Parameter] public Func<Task>? NextTurnAsync { get; set; }
	[Parameter] public Server.DisplayableShape[]? Provinces { get; set; }
	[Parameter] public Action<Server.ProvinceVariables[]>? UpdateProvinces { get; set; }
	async Task<int?> OnClick(int clicked, int? from)
	{
		var r = await http.PostJsonResponseAsync<Server.Click, Server.Switch>("api/Switch/Clicked", new Server.Click(LoggedIn.U, from, clicked, LoggedIn.G));
		Switch(r.M, r.F, r.T);
		return r.S;
	}
	int? PowersCount = null, PlayerMoney = 0;
	public async Task Update()
	{
		PowersCount = await http.GetJsonAsync<int>("api/Powers/Count");
		PlayerMoney = await http.PostJsonResponseAsync<int, int>("api/Player/Money", LoggedIn.U);
		UpdateProvinces!(await http.GetJsonAsync<Server.ProvinceVariables[]>(Preview ? "api/Provinces/Preview" : "api/Provinces/Current"));
		this.StateHasChanged();
	}
	protected override Task OnInitializedAsync() => Update();
}
<nav>
	@if (Preview)
	{
		<a @onclick="() => Switch(Mode.Map, null, null)">Zpět</a>
		<a class="this">Náhled</a>
	}
	else
	{
		@if (IsActive)
		{
			<a @onclick="NextTurnAsync">Konec</a>
		}
		else
		{
			<a @onclick="LogoutAsync">Odhlášení</a>
		}
		<a class="this">Imperit</a>
		<a @onclick="() => Switch(Mode.Players, null, null)">@(PlayerMoney)@Sym.Money</a>
		<a @onclick="() => Switch(Mode.Preview, null, null)">Náhled</a>
		@if (PowersCount is int count && count > 2)
		{
			<a @onclick="() => Switch(Mode.Powers, null, null)">Výsledky</a>
		}
	}
</nav>
<main>
	<Map Width="1000" Height="1000" Provinces="Provinces" Select="OnClick" FontSize="9" SelectedColor="new Color(0, 0, 0, 100)" />
</main>