@inject ImperitClient http;

@code{
	[Parameter] public Data.Session Session { get; set; } = new Data.Session();
	[Parameter] public Data.GameState State { get; set; }
	[Parameter] public Func<Task>? LogoutAsync { get; set; }
	[Parameter] public Action Start { get; set; } = () => { };
	System.Timers.Timer Timer = new System.Timers.Timer(3000);
	string Text { get; set; } = "";
	async void UpdateAsync(object? _1 = null, object? _2 = null)
	{
		var state = await http.PostAsync<Data.Session, Data.GameState>("api/Player/Correct", Session);
		if (state == Data.GameState.Started)
		{
			Timer.Stop();
			Start();
		}
		Text = state switch
		{
			Data.GameState.Created => "Zatím jsi jediný zaregistrovaný hráč, počkej prosím na další",
			Data.GameState.Countdown => "Hra začne v " + (await http.PostAsync<int, DateTimeOffset?>("api/Game/StartTime", Session.G))!.Value.ToString("HH:mm:ss"),
			Data.GameState.Finished => "Hra již skončila, můžeš se zaregistrovat do další",
			_ => ""
		};
		StateHasChanged();
	}
	protected override void OnInitialized()
	{
		UpdateAsync();
		Timer.Elapsed += UpdateAsync;
		Timer.Start();
	}
}

<NavMenu Options="Odhlášení;Hra" Selected="1" OnClickAsync="i => i == 0 ? LogoutAsync!() : Task.Run(() => { })"/>
<main>@Text</main>